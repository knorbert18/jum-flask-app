<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ransbet - Account</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

    <style>
        .cart-count {
            background: red;
            color: white;
            border-radius: 9999px;
            padding: 0 6px;
            font-size: 12px;
            margin-left: 4px;
            vertical-align: top;
            min-width: 20px;
            text-align: center;
            line-height: 20px;
            font-weight: 600;
            user-select: none;
        }
    </style>
</head>

<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen flex flex-col">
    <header class="bg-white dark:bg-gray-800 dark:text-gray-100 shadow p-4 flex justify-between items-center">
        <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
            <img src="{{ url_for('static', filename='images/ransbet-logo.jpg') }}" alt="Ransbet Logo" class="h-10 w-10 rounded-full border-2 border-red-500 shadow-md" />
            <span class="text-xl font-bold text-gray-800 dark:text-white">Ransbet</span>
        </a>

        <button id="mobileMenuBtn" class="md:hidden text-gray-700 dark:text-gray-200">
            <i class="fas fa-bars text-2xl"></i>
        </button>

        <nav class="hidden md:flex items-center gap-4 text-gray-700 dark:text-gray-300 text-sm" id="mainNav">
            <a href="{{ url_for('index') }}" class="hover:text-orange-500 flex items-center gap-1">
                <i class="fas fa-home"></i> <span data-i18n="home">Home</span>
            </a>

            <div class="relative" id="accountWrapper">
                <button id="accountBtn" class="flex items-center gap-1 hover:text-orange-500 focus:outline-none">
                    <i class="fas fa-user"></i> <span data-i18n="account">Account</span>
                    <i class="fas fa-chevron-down text-xs"></i>
                </button>
                <div id="accountDropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 shadow-lg rounded-lg text-gray-900 dark:text-gray-100 hidden z-50">
                    <a href="{{ url_for('orders') }}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <i class="fas fa-box mr-2"></i> <span data-i18n="orders">Orders</span>
                    </a>
                    <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <i class="fas fa-heart mr-2"></i> <span data-i18n="wishlist">Wish List</span>
                    </a>
                    <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <i class="fas fa-cog mr-2"></i> <span data-i18n="settings">Account Settings</span>
                    </a>
                    <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <i class="fas fa-map-marker-alt mr-2"></i> <span data-i18n="addresses">Addresses</span>
                    </a>
                    <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <i class="fas fa-credit-card mr-2"></i> <span data-i18n="payments">Payment Methods</span>
                    </a>
                </div>
            </div>

            <a href="#" class="hover:text-orange-500"><span data-i18n="help">Help</span></a>

            <a href="{{ url_for('cart') }}" class="relative flex items-center hover:text-orange-500">
                <i class="fas fa-shopping-cart"></i> <span data-i18n="cart">Cart</span>
                <span class="cart-count">0</span>
            </a>

            <select id="languageSelect" class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm rounded px-2 py-1">
                <option value="en">English</option>
                <option value="fr">Français</option>
            </select>

            <button id="darkModeToggle" class="ml-2 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition focus:outline-none focus:ring-2 focus:ring-orange-500 flex items-center gap-2">
                <i class="fas fa-moon"></i> <span data-i18n="dark_mode">Dark Mode</span>
            </button>
        </nav>
    </header>

    <div class="flex flex-grow">
        <!-- Sidebar for mobile -->
        <aside id="mobileSidebar" class="fixed inset-0 bg-gray-800 bg-opacity-75 z-50 hidden">
            <div class="flex flex-col bg-white dark:bg-gray-800 w-64 h-full p-4">
                <button id="closeSidebarBtn" class="text-gray-700 dark:text-gray-200 mb-4">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                <h2 class="text-lg font-semibold mb-4">Account Navigation</h2>
                <ul>
                    <li><a href="{{ url_for('orders') }}" class="block px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">Orders</a></li>
                    <li><a href="#" class="block px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">Wish List</a></li>
                    <li><a href="#" class="block px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">Account Settings</a></li>
                    <li><a href="#" class="block px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">Addresses</a></li>
                    <li><a href="#" class="block px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">Payment Methods</a></li>
                </ul>
            </div>
        </aside>

        <main class="flex-grow bg-gray-50 dark:bg-gray-900 py-8">
            <div class="max-w-4xl mx-auto px-4">
                <h1 class="text-3xl font-bold mb-6" data-i18n="account_settings">Account Settings</h1>

                <section class="mb-8 bg-white dark:bg-gray-800 p-6 rounded shadow">
                    <h2 class="text-xl font-semibold mb-4" data-i18n="profile_info">Profile Information</h2>
                    <form id="accountForm">
                        <div class="mb-4">
                            <label for="name" class="block mb-1 font-medium" data-i18n="name">Name</label>
                            <input type="text" id="name" class="w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600" />
                        </div>
                        <div class="mb-4">
                            <label for="email" class="block mb-1 font-medium" data-i18n="email">Email</label>
                            <input type="email" id="email" class="w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600" />
                        </div>
                        <button type="submit" class="bg-orange-500 text-white px-5 py-2 rounded hover:bg-orange-600" data-i18n="save">Save</button>
                        <p id="successMessage" class="text-green-500 mt-3 hidden" data-i18n="success">Changes saved successfully!</p>
                    </form>
                </section>
            </div>
        </main>
    </div>

    <script>
        const translations = {
            en: {
                home: "Home", account: "Account", orders: "Orders", wishlist: "Wish List", settings: "Account Settings", addresses: "Addresses", payments: "Payment Methods", help: "Help", cart: "Cart", dark_mode: "Dark Mode", account_settings: "Account Settings", profile_info: "Profile Information", name: "Name", email: "Email", save: "Save", success: "Changes saved successfully!"
            },
            fr: {
                home: "Accueil", account: "Compte", orders: "Commandes", wishlist: "Liste de souhaits", settings: "Paramètres", addresses: "Adresses", payments: "Méthodes de paiement", help: "Aide", cart: "Panier", dark_mode: "Mode Sombre", account_settings: "Paramètres du compte", profile_info: "Informations du profil", name: "Nom", email: "Email", save: "Enregistrer", success: "Modifications enregistrées avec succès !"
            }
        };

        function applyTranslations(lang) {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            localStorage.setItem('lang', lang);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const htmlEl = document.documentElement;
            const darkModeToggle = document.getElementById('darkModeToggle');
            const languageSelect = document.getElementById('languageSelect');
            const accountBtn = document.getElementById('accountBtn');
            const accountDropdown = document.getElementById('accountDropdown');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileSidebar = document.getElementById('mobileSidebar');
            const closeSidebarBtn = document.getElementById('closeSidebarBtn');

            const savedLang = localStorage.getItem('lang') || 'en';
            languageSelect.value = savedLang;
            applyTranslations(savedLang);

            languageSelect.addEventListener('change', (e) => {
                applyTranslations(e.target.value);
            });

            // Theme toggle logic
            function applyTheme(theme) {
                if (theme === 'dark') {
                    htmlEl.classList.add('dark');
                    darkModeToggle.innerHTML = '<i class="fas fa-sun"></i> ' + translations[savedLang]['dark_mode'].replace("Dark", "Light");
                } else {
                    htmlEl.classList.remove('dark');
                    darkModeToggle.innerHTML = '<i class="fas fa-moon"></i> ' + translations[savedLang]['dark_mode'];
                }
                localStorage.setItem('theme', theme);
            }

            const storedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(storedTheme || (prefersDark ? 'dark' : 'light'));

            darkModeToggle.addEventListener('click', () => {
                const isDark = htmlEl.classList.contains('dark');
                applyTheme(isDark ? 'light' : 'dark');
            });

            accountBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                accountDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!accountDropdown.contains(e.target) && !accountBtn.contains(e.target)) {
                    accountDropdown.classList.add('hidden');
                }
            });

            mobileMenuBtn.addEventListener('click', () => {
                mobileSidebar.classList.toggle('hidden');
            });

            closeSidebarBtn.addEventListener('click', () => {
                mobileSidebar.classList.add('hidden');
            });

            const form = document.getElementById('accountForm');
            const successMessage = document.getElementById('successMessage');
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');

            // Load from localStorage
            nameInput.value = localStorage.getItem('userName') || '';
            emailInput.value = localStorage.getItem('userEmail') || '';

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                localStorage.setItem('userName', nameInput.value);
                localStorage.setItem('userEmail', emailInput.value);
                successMessage.classList.remove('hidden');
                setTimeout(() => successMessage.classList.add('hidden'), 3000);
            });

            function updateCartCount() {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const count = cart.reduce((total, item) => total + (item.quantity || 1), 0);
                document.querySelector('.cart-count').innerText = count;
            }

            updateCartCount();
            document.addEventListener('cartUpdated', updateCartCount);
        });
    </script>
</body>
</html>
